<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add Expense Category | Expense Tracker</title>
<style>
    body { font-family:"Segoe UI", sans-serif; margin:0; padding:0; background:#f3f4f6; }
    header { background:#4f46e5; color:white; padding:16px; display:flex; justify-content:space-between; align-items:center; }
    header h2 { margin:0; }
    header button { padding:8px 16px; background:#4338ca; border:none; color:white; border-radius:6px; cursor:pointer; }
    header button:hover { background:#3730a3; }

    /* Navigation bar */
    nav { background:#3730a3; display:flex; gap:12px; padding:8px 16px; }
    nav a { color:white; text-decoration:none; font-weight:600; padding:6px 12px; border-radius:6px; transition: background 0.2s; }
    nav a:hover { background:#4f46e5; }

    main { padding:24px; max-width:600px; margin:0 auto; }
    .form-group { margin-bottom:16px; display:flex; flex-direction:column; }
    .form-group label { font-weight:600; margin-bottom:6px; }
    .form-group input { padding:8px 10px; border-radius:6px; border:1px solid #d1d5db; font-size:14px; width:100%; }

    button { padding:10px 16px; border:none; border-radius:8px; cursor:pointer; font-weight:600; margin-right:10px; transition: background 0.2s; }
    #addCategoryBtn { background:#4f46e5; color:white; }
    #addCategoryBtn:hover { background:#4338ca; }
    #resetBtn { background:#e5e7eb; color:#111827; }
    #resetBtn:hover { background:#d1d5db; }

    .message-box { padding:10px; border-radius:6px; margin-bottom:16px; display:none; text-align:center; }
    .message-box.error { background:#fee2e2; color:#b91c1c; }
    .message-box.success { background:#d1fae5; color:#065f46; }

    #categoryTable { width:100%; border-collapse:collapse; background:white; border-radius:8px; overflow:hidden; margin-top:24px; }
    #categoryTable th, #categoryTable td { padding:12px; border-bottom:1px solid #e5e7eb; text-align:left; }
    #categoryTable th { background:#e0e7ff; }
</style>
</head>
<body>

<header>
    <h2>Expense-IT !! <br> Welcome, <span id="username"></span> !</h2>
    <button id="logoutBtn">Logout</button>
</header>

<nav>
    <a href="dashboard1.html">View Current Expenses</a>
    <a href="dashboard2.html">Add a New Expense</a>
    <a href="dashboard3.html">Add a New Expense Category</a>
    <a href="dashboard4.html">Expense Analytics and Visualization</a>
    <a href="profile.html">Profile Page Update</a>
</nav>

<main>
    <div id="messageBox" class="message-box"></div>

    <div class="form-group">
        <label for="categoryName">Expense Category *</label>
        <input type="text" id="categoryName" placeholder="Enter category name">
    </div>

    <div>
        <button id="addCategoryBtn">Add Category</button>
        <button id="resetBtn">Reset</button>
    </div>

    <table id="categoryTable">
        <thead>
            <tr>
                <th>Existing Categories</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</main>

<script>
const customer_id = localStorage.getItem("customer_id");
const username = localStorage.getItem("username") || "User";
if(!customer_id) window.location.href="index.html";

document.getElementById("username").textContent = username;
const msgBox = document.getElementById("messageBox");
const categoryInput = document.getElementById("categoryName");
const categoryTableBody = document.querySelector("#categoryTable tbody");

document.getElementById("logoutBtn").addEventListener("click", ()=>{
    localStorage.removeItem("customer_id");
    localStorage.removeItem("username");
    window.location.href="index.html";
});

function showMessage(msg, type="success"){
    msgBox.className=`message-box ${type}`;
    msgBox.textContent = msg;
    msgBox.style.display = "block";
    setTimeout(()=>{ msgBox.style.display = "none"; }, 2500);
}

// Fetch categories
async function fetchCategories(){
    try{
        const res = await fetch("http://localhost:3000/dashboard/categories", {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify({ customer_id })
        });
        const data = await res.json();
        if(data.success){
            categoryTableBody.innerHTML = "";
            data.categories.forEach(cat=>{
                const tr = document.createElement("tr");
                tr.innerHTML = `<td>${cat.expense_name}</td>`;
                categoryTableBody.appendChild(tr);
            });
        } else showMessage(data.message,"error");
    }catch(err){
        showMessage("Error fetching categories","error");
        console.error(err);
    }
}

// Add category
document.getElementById("addCategoryBtn").addEventListener("click", async ()=>{
    const name = categoryInput.value.trim();
    if(!name) return showMessage("Category name is required","error");

    try{
        const res = await fetch("http://localhost:3000/dashboard/add_category", {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify({ customer_id, expense_name: name })
        });
        const data = await res.json();
        if(data.success){
            showMessage(data.message,"success");
            categoryInput.value = "";
            fetchCategories();
        } else {
            showMessage(data.message || "Failed to add category","error");
        }
    }catch(err){
        showMessage("Network error","error");
        console.error(err);
    }
});

// Reset
document.getElementById("resetBtn").addEventListener("click", ()=>{
    categoryInput.value = "";
});

// Initialize
fetchCategories();
</script>

</body>
</html>
